#pragma config(Hubs,  S1, HTMotor,  HTServo,  none,     none)
#pragma config(Motor,  motorA,          Conveyor,    tmotorNormal, PIDControl, encoder)
#pragma config(Motor,  motorB,          IndicatorLight, tmotorNormal, PIDControl, encoder)
#pragma config(Motor,  mtr_S1_C1_1,     Left,          tmotorNormal, openLoop)
#pragma config(Motor,  mtr_S1_C1_2,     Right,         tmotorNormal, openLoop, reversed)
#pragma config(Servo,  srvo_S1_C2_1,    Kicker,               tServoStandard)
#pragma config(Servo,  srvo_S1_C2_2,    Slide,                tServoStandard)
#pragma config(Servo,  srvo_S1_C2_3,    Door,                 tServoStandard)
#pragma config(Servo,  srvo_S1_C2_4,    ,                     tServoStandard)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

/////////////////////////////////////////////////////////////////////////////////////////////////////
//
//                           Tele-Operation Mode Code Template
//
// This file contains a template for simplified creation of an tele-op program for an FTC
// competition.
//
// You need to customize two functions with code unique to your specific robot.
//
/////////////////////////////////////////////////////////////////////////////////////////////////////


#include "shared/include.c"
#include "TeleOp/include.c"


void initializeRobot()
{
	MechanismInit();

	return;
}





void DriveControl(Controller& controller)
{
    //  power
  /*
    if ( ControllerButtonIsPressed(controller, ControllerButton1) )
    {
		DrivePowerMultiplier = kDrivePowerLow;
    }
    else if ( ControllerButtonIsPressed(controller, ControllerButton2) )
    {
		DrivePowerMultiplier = kDrivePowerNormal;
    }
    else if ( ControllerButtonIsPressed(controller, ControllerButton3) )
    {
		DrivePowerMultiplier = kDrivePowerHigh;
    }
*/

    //  tank drive
    //SetMotorPower(Left, controller.leftJoystick.y);
    //SetMotorPower(Right, controller.rightJoystick.y);


    float e = 2.7182818285;
    float k = -1 / (1 - e);

    motor[Left] = k * ( powf(e, controller.leftJoystick.y) - 1) * 50;
    motor[Right] = k * ( powf(e, controller.rightJoystick.y) - 1) * 50;


	/*
    //  omni strafe
    bool r1, r2, l1, l2, left, right;
	  r1 = ControllerButtonIsPressed(controller, ControllerButtonR1);
	  r2 = ControllerButtonIsPressed(controller, ControllerButtonR2);
	  l1 = ControllerButtonIsPressed(controller, ControllerButtonL1);
	  l2 = ControllerButtonIsPressed(controller, ControllerButtonL2);

    if ( r1 ) OmniSetStrafePower(-.5);
    else if ( r2 ) OmniSetStrafePower(-1);
    else if ( l1 ) OmniSetStrafePower(.5);
    else if ( l2 ) OmniSetStrafePower(1);
    else OmniSetStrafePower(0);
	*/
}

void MechanismControl(Controller& controller)
{
    //  slide adjustment
    if ( controller.dPad.y == 1 && !MechanismSlideIsMoving())
    {
		StartTask(MechanismSlideIncrementPosition);
    }
    else if ( controller.dPad.y == -1 && !MechanismSlideIsMoving() )
    {
		StartTask(MechanismSlideDecrementPosition);
    }



    //  kicker
	if ( !MechanismIsKicking && ControllerButtonIsPressed(controller, ControllerButtonR1) )
	{
		StartTask(MechanismKickBaton);
	}





	//  conveyor
	if ( ControllerButtonIsPressed(controller, ControllerButtonL1) )		//	forward
	{
		motor[Conveyor] = 50;
	}
	else if ( ControllerButtonIsPressed(controller, ControllerButtonL2) )	//	reverse
	{
		motor[Conveyor] = -50;
	}
	else																	//	stop
	{
		motor[Conveyor] = 0;
	}




	//  magnet slide position
	if ( ControllerButtonIsPressed(controller, ControllerButton4) )
	{
		MechanismSlideSetMagnetPosition();
	}

	//  regular slide position
	if ( ControllerButtonIsPressed(controller, ControllerButton2) )
	{
		MechanismSlideSetRegularPosition();
	}

	//  down position
	if ( ControllerButtonIsPressed(controller, ControllerButton3) )
	{
		MechanismSlideSetDownPosition();
	}

	//  long position
	if ( ControllerButtonIsPressed(controller, ControllerButton1)
	{
		MechanismSlideSetLongPosition();
	}
}






task main()
{
	initializeRobot();

	waitForStart();   // wait for start of tele-op phase


	while (true)
	{
		Controller primary, secondary;
		UpdatePrimaryController(primary);
		UpdateSecondaryController(secondary);

		DriveControl(primary);
		MechanismControl(secondary);

    /*
		if ( MagneticSensorMagnetIsPresent() )
		{
			motor[IndicatorLight] = 100;  //  turn the light on
		}
		else
		{
			motor[IndicatorLight] = 0;
		}
		*/
	}
}
