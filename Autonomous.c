#pragma config(Hubs,  S1, HTMotor,  HTMotor,  HTServo,  none)
#pragma config(Sensor, S2,     IR,                  sensorNone)
#pragma config(Motor,  motorA,          Conveyor,      tmotorNormal, PIDControl, reversed, encoder)
#pragma config(Motor,  mtr_S1_C1_1,     Front,         tmotorNormal, openLoop, reversed)
#pragma config(Motor,  mtr_S1_C1_2,     Back,          tmotorNormal, openLoop)
#pragma config(Motor,  mtr_S1_C2_1,     Left,          tmotorNormal, openLoop, reversed)
#pragma config(Motor,  mtr_S1_C2_2,     Right,         tmotorNormal, openLoop)
#pragma config(Servo,  srvo_S1_C3_1,    Kicker,               tServoStandard)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

/////////////////////////////////////////////////////////////////////////////////////////////////////
//
//                           Autonomous Mode Code Template
//
// This file contains a template for simplified creation of an autonomous program for an TETRIX robot
// competition.
//
// You need to customize two functions with code unique to your specific robot.
//
/////////////////////////////////////////////////////////////////////////////////////////////////////



#include "Lib/include.c"



void setStartInfo()
{
	FTCTeamSetCurrent(FTCTeamRed);					//	tell it what team we are on
	FTCFieldSetStartPosition(FTCStartPositionLeft);	//	tell it which start square we're on
}



void initializeRobot()
{
	FTCFieldInit();	//  initialize the map of the field
	setStartInfo();
	
	MechanismInit();
		
	
	PlaySound(soundUpwardTones);
}



static bool gettingDoubler;	//	global variable that tells whether or not the GetDoublerBaton task is running

task GetDoublerBaton()
{
	gettingDoubler = true;
	
	
	KeyPointID dispenserID = FTCFieldGetKeyPointOfCenterDispenserForTeam(FTCTeamGetCurrent());	//	get key point of the dispenser
	KeyPointID currentID = MapGetCurrentNodeID();
	RobotTravelFromKeyPointToKeyPoint(currentID, dispenserID);	// go to the dispenser
	
	//	FIXME: turn towards it
	
	
	RobotMountCenterDispenser();	//	get aligned with the dispenser
	MechanismCycleConveyor();		//	pull in the doubler baton & a few others
	
	//	FIXME: backup to node
	
	
	gettingDoubler = false;
}



task GetToBridgeAndBalance()
{
	KeyPointID bridgeID = FTCFieldGetKeyPointOfBridgeForTeam(FTCTeamGetCurrent());	//	FIXME: get id of closest bridge!!!!!!!!!!!!
	KeyPointID currentID = MapGetCurrentNodeID();
	RobotTravelFromKeyPointToKeyPoint(currentID, bridgeID);	//	go to the bridge
	
	RobotBalance();	//	use the accelerometor to balance the bot
}




task main()
{
	initializeRobot();
	
	waitForStart();		// Wait for the beginning of autonomous phase.
	
	long startTime = nPgmTime;
	
	
	
	
	//	FIXME: move the bot to the start node.  our starting spot is just off from the start node!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
	
	
	
	
	StartTask(GetDoublerBaton);
	
	while ( true )
	{
		wait10Msec(100);	//	wait 1 second
		
		if ( nPgmTime - startTime < 25000 )	//	if 25 seconds are up, abort the doubler mission and go balance on bridge
		{
			//	FIXME: abort baton getting
			
			break;
		}
		else if ( !gettingDoubler )	//	see if we're done getting the doubler yet
		{
			break;
		}
	}
	
	StartTask(GetToBridgeAndBalance);
}



